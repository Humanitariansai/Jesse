{
  "name": "Jesse — AI Job Posting Harvester",
  "nodes": [
    {
      "parameters": {},
      "id": "Start",
      "name": "Start",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [100, 300]
    },
    {
      "parameters": {
        "values": {
          "string": [
            { "name": "SEED_QUERIES", "value": "site:lever.co engineer; site:greenhouse.io data scientist" },
            { "name": "REGION", "value": "United States" },
            { "name": "LANGUAGE", "value": "en" },
            { "name": "CONFIDENCE_THRESHOLD", "value": "0.72" },
            { "name": "MAX_NEW_SOURCES", "value": "5" },
            { "name": "DISCORD_CHANNEL_ID", "value": "" }
          ]
        }
      },
      "id": "Config",
      "name": "Config",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [300, 300]
    },
    {
      "parameters": {
        "content": "={\n  \"search_queries\": [\n    \"site:lever.co machine learning engineer\",\n    \"site:greenhouse.io data scientist\",\n    \"site:workday.com product manager\",\n    \"site:jobs.lever.co ai research\",\n    \"site:boards.greenhouse.io machine learning\"\n  ],\n  \"crawl_budget\": 20,\n  \"priority_rules\": [\n    \"prefer postings with skills blocks\",\n    \"prefer recent < 30 days\"\n  ],\n  \"extraction_instructions\": {\n    \"fields\": [\n      \"title\",\n      \"company\",\n      \"location\",\n      \"posted_date\",\n      \"employment_type\",\n      \"description\",\n      \"requirements\",\n      \"skills\"\n    ],\n    \"format\": \"json\",\n    \"few_shots\": [\n      {\n        \"html_excerpt\": \"<div class=\\\"job\\\">Skills: Python, SQL, AWS</div>\",\n        \"output\": {\"skills\": [\"Python\", \"SQL\", \"AWS\"]}\n      },\n      {\n        \"html_excerpt\": \"<ul><li>Proficiency in TensorFlow or PyTorch</li></ul>\",\n        \"output\": {\"skills\": [\"TensorFlow\", \"PyTorch\"]}\n      }\n    ]\n  },\n  \"uncertainty_policy\": {\n    \"metric\": \"soft_confidence\",\n    \"threshold\": {{$node[\"Config\"].json.CONFIDENCE_THRESHOLD || 0.72}},\n    \"retry_max\": 1,\n    \"on_low_confidence\": \"save_anyway_and_notify\"\n  }\n}",
        "options": {}
      },
      "id": "DemoLLMPlan",
      "name": "Demo LLM Plan (Static)",
      "type": "n8n-nodes-base.textTemplate",
      "typeVersion": 1,
      "position": [500, 300]
    },
    {
      "parameters": {
        "functionCode": "// Parse the controller plan\nlet plan;\ntry {\n  const planData = $node['DemoLLMPlan'].json;\n  if (typeof planData === 'string') {\n    plan = JSON.parse(planData);\n  } else {\n    plan = planData;\n  }\n} catch (e) {\n  console.log('Error parsing plan:', e.message);\n  plan = {\n    search_queries: ['site:lever.co engineer', 'site:greenhouse.io data scientist'],\n    extraction_instructions: {\n      fields: ['title', 'company', 'location', 'skills']\n    }\n  };\n}\n\nreturn [{ json: plan }];"
      },
      "id": "ParsePlan",
      "name": "Parse Controller Plan",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [700, 300]
    },
    {
      "parameters": {
        "functionCode": "// Split search queries into separate items\nconst qs = Array.isArray($node['ParsePlan'].json.search_queries) \n  ? $node['ParsePlan'].json.search_queries \n  : ['site:lever.co engineer'];\n\nconst max = parseInt($node['Config'].json.MAX_NEW_SOURCES || 5, 10);\nreturn qs.slice(0, max).map(q => ({ json: { query: q } }));"
      },
      "id": "SplitQueries",
      "name": "Split Search Queries",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 300]
    },
    {
      "parameters": {
        "batchSize": 1
      },
      "id": "SplitBatches",
      "name": "Split Into Batches",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 1,
      "position": [1100, 300]
    },
    {
      "parameters": {
        "content": "={\n  \"results\": [\n    {\n      \"title\": \"Search Result 1\",\n      \"link\": \"https://example.com/jobs/12345\",\n      \"snippet\": \"Example job posting for a software engineer position...\"\n    },\n    {\n      \"title\": \"Search Result 2\",\n      \"link\": \"https://example.com/jobs/67890\",\n      \"snippet\": \"Another job posting for a data scientist role...\"\n    }\n  ]\n}",
        "options": {}
      },
      "id": "DemoSearchResults",
      "name": "Demo Search Results",
      "type": "n8n-nodes-base.textTemplate",
      "typeVersion": 1,
      "position": [1300, 300]
    },
    {
      "parameters": {
        "functionCode": "// Extract URLs from search results\nlet results;\ntry {\n  const resultsData = $node['DemoSearchResults'].json;\n  if (typeof resultsData === 'string') {\n    results = JSON.parse(resultsData);\n  } else {\n    results = resultsData;\n  }\n} catch (e) {\n  console.log('Error parsing search results:', e.message);\n  results = { results: [] };\n}\n\nconst links = (results.results || []).map(r => r.link || '').filter(Boolean);\n\n// If no links found, create a demo link\nif (links.length === 0) {\n  links.push('https://example.com/jobs/demo-job');\n}\n\nreturn links.map(url => ({ json: { url } }));"
      },
      "id": "ExtractURLs",
      "name": "Extract Result URLs",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1500, 300]
    },
    {
      "parameters": {
        "batchSize": 1
      },
      "id": "SplitURLs",
      "name": "Split URLs",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 1,
      "position": [1700, 300]
    },
    {
      "parameters": {
        "content": "=<html>\n  <body>\n    <div class=\"job-posting\">\n      <h1 class=\"job-title\">Senior Machine Learning Engineer</h1>\n      <div class=\"company\">Example Tech Inc.</div>\n      <div class=\"location\">San Francisco, CA (Remote)</div>\n      <div class=\"posted-date\">Posted: June 15, 2025</div>\n      <div class=\"employment-type\">Full-time</div>\n      \n      <div class=\"description\">\n        <p>Example Tech is looking for a Senior Machine Learning Engineer to join our AI team. You will be responsible for developing and deploying machine learning models to improve our product recommendations.</p>\n      </div>\n      \n      <div class=\"requirements\">\n        <h3>Requirements:</h3>\n        <ul>\n          <li>5+ years of experience in machine learning or related field</li>\n          <li>Strong programming skills in Python</li>\n          <li>Experience with deep learning frameworks</li>\n          <li>MS or PhD in Computer Science, AI, or related field</li>\n        </ul>\n      </div>\n      \n      <div class=\"skills\">\n        <h3>Technical Skills:</h3>\n        <ul>\n          <li>Python</li>\n          <li>TensorFlow or PyTorch</li>\n          <li>SQL</li>\n          <li>AWS or GCP</li>\n          <li>Docker</li>\n        </ul>\n      </div>\n    </div>\n  </body>\n</html>",
        "options": {}
      },
      "id": "DemoJobPage",
      "name": "Demo Job Page HTML",
      "type": "n8n-nodes-base.textTemplate",
      "typeVersion": 1,
      "position": [1900, 300]
    },
    {
      "parameters": {
        "content": "={\n  \"title\": \"Senior Machine Learning Engineer\",\n  \"company\": \"Example Tech Inc.\",\n  \"location\": \"San Francisco, CA (Remote)\",\n  \"posted_date\": \"June 15, 2025\",\n  \"employment_type\": \"Full-time\",\n  \"description\": \"Example Tech is looking for a Senior Machine Learning Engineer to join our AI team. You will be responsible for developing and deploying machine learning models to improve our product recommendations.\",\n  \"requirements\": [\n    \"5+ years of experience in machine learning or related field\",\n    \"Strong programming skills in Python\",\n    \"Experience with deep learning frameworks\",\n    \"MS or PhD in Computer Science, AI, or related field\"\n  ],\n  \"skills\": [\n    \"Python\",\n    \"TensorFlow\",\n    \"PyTorch\",\n    \"SQL\",\n    \"AWS\",\n    \"GCP\",\n    \"Docker\"\n  ],\n  \"source_url\": \"{{$json.url}}\",\n  \"soft_confidence\": 0.85,\n  \"needs_review\": false,\n  \"reasons\": []\n}",
        "options": {}
      },
      "id": "DemoLLMParser",
      "name": "Demo LLM Parser Result",
      "type": "n8n-nodes-base.textTemplate",
      "typeVersion": 1,
      "position": [2100, 300]
    },
    {
      "parameters": {
        "functionCode": "// Parse the extraction result\nlet parsed;\ntry {\n  const parserData = $node['DemoLLMParser'].json;\n  if (typeof parserData === 'string') {\n    parsed = JSON.parse(parserData);\n  } else {\n    parsed = parserData;\n  }\n} catch (e) {\n  console.log('Error parsing LLM result:', e.message);\n  parsed = {};\n}\n\n// Add the source URL if not present\nif (!parsed.source_url) {\n  parsed.source_url = $json.url || 'https://example.com/jobs/demo-job';\n}\n\n// Assess confidence\nconst threshold = parseFloat($node['Config'].json.CONFIDENCE_THRESHOLD || 0.72);\nconst isConfident = (parsed.soft_confidence || 0) >= threshold && \n                  Array.isArray(parsed.skills) && \n                  parsed.skills.length > 0 && \n                  parsed.title && \n                  parsed.company;\n\nreturn [{ \n  json: { \n    parsed, \n    isConfident, \n    threshold \n  } \n}];"
      },
      "id": "AssessResult",
      "name": "Assess Parser Result",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2300, 300]
    },
    {
      "parameters": {
        "functionCode": "// Build the final record\nconst p = $json.parsed || {};\nconst now = new Date().toISOString();\n\nconst record = {\n  title: p.title || 'Unknown Title',\n  company: p.company || 'Unknown Company',\n  location: p.location || null,\n  posted_date: p.posted_date || null,\n  employment_type: p.employment_type || null,\n  description: p.description || null,\n  requirements: Array.isArray(p.requirements) ? p.requirements : [],\n  skills: Array.isArray(p.skills) ? p.skills : [],\n  source_url: p.source_url || $json.url || null,\n  soft_confidence: p.soft_confidence || 0,\n  needs_review: !$json.isConfident,\n  reasons: Array.isArray(p.reasons) ? p.reasons : [],\n  harvest_run_ts: now\n};\n\n// If it needs review, add a reason\nif (record.needs_review && !record.reasons.includes('low-confidence')) {\n  record.reasons.push('low-confidence');\n}\n\nreturn [{ json: { record } }];"
      },
      "id": "BuildRecord",
      "name": "Build JSON Record",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2500, 300]
    },
    {
      "parameters": {
        "path": "=/jesse/job_harvester/{{$json.record.company}}_{{$json.record.title}}.json",
        "options": {}
      },
      "id": "WriteFile",
      "name": "Write Result to File",
      "type": "n8n-nodes-base.writeBinaryFile",
      "typeVersion": 1,
      "position": [2700, 200]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$node['Config'].json.DISCORD_CHANNEL_ID}}",
              "operation": "isNotEmpty"
            }
          ]
        }
      },
      "id": "CheckDiscordConfig",
      "name": "Check if Discord is Configured",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [2700, 300]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "send",
        "channelId": "={{$node['Config'].json.DISCORD_CHANNEL_ID}}",
        "message": "New job harvested ({{ $json.record.needs_review ? '⚠️ NEEDS REVIEW' : '✅ OK' }})\nTitle: {{ $json.record.title }} | Company: {{ $json.record.company }}\nConfidence: {{ $json.record.soft_confidence.toFixed(2) }}\nSkills: {{ ($json.record.skills || []).slice(0,5).join(', ') }}"
      },
      "id": "DiscordNotify",
      "name": "Discord: Notify",
      "type": "n8n-nodes-base.discord",
      "typeVersion": 1,
      "position": [2900, 250]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{$node['SplitURLs'].context.currentRunIndex}}",
              "operation": "smaller",
              "value2": 1
            }
          ]
        }
      },
      "id": "CheckMoreURLs",
      "name": "Check for More URLs",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [2700, 400]
    },
    {
      "parameters": {},
      "id": "NextURL",
      "name": "Next URL",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [2900, 400]
    },
    {
      "parameters": {},
      "id": "WorkflowDone",
      "name": "Workflow Complete",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [2900, 500]
    }
  ],
  "connections": {
    "Start": {
      "main": [
        [
          {
            "node": "Config",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Config": {
      "main": [
        [
          {
            "node": "DemoLLMPlan",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DemoLLMPlan": {
      "main": [
        [
          {
            "node": "ParsePlan",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ParsePlan": {
      "main": [
        [
          {
            "node": "SplitQueries",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SplitQueries": {
      "main": [
        [
          {
            "node": "SplitBatches",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SplitBatches": {
      "main": [
        [
          {
            "node": "DemoSearchResults",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DemoSearchResults": {
      "main": [
        [
          {
            "node": "ExtractURLs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ExtractURLs": {
      "main": [
        [
          {
            "node": "SplitURLs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SplitURLs": {
      "main": [
        [
          {
            "node": "DemoJobPage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DemoJobPage": {
      "main": [
        [
          {
            "node": "DemoLLMParser",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DemoLLMParser": {
      "main": [
        [
          {
            "node": "AssessResult",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AssessResult": {
      "main": [
        [
          {
            "node": "BuildRecord",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BuildRecord": {
      "main": [
        [
          {
            "node": "WriteFile",
            "type": "main",
            "index": 0
          },
          {
            "node": "CheckDiscordConfig",
            "type": "main",
            "index": 0
          },
          {
            "node": "CheckMoreURLs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CheckDiscordConfig": {
      "main": [
        [
          {
            "node": "DiscordNotify",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "CheckMoreURLs": {
      "main": [
        [
          {
            "node": "NextURL",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "WorkflowDone",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "NextURL": {
      "main": [
        [
          {
            "node": "SplitURLs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "pinData": {},
  "versionId": "1",
  "meta": {
    "instanceId": "demo-instance",
    "description": "Simplified job posting harvester with static demo data to help students learn the workflow structure."
  }
}